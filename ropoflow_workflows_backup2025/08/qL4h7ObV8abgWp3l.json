{
  "active": true,
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Execution Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "crear orden": {
      "main": [
        [
          {
            "node": "Crear nota de creacion desde ropofy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "pedido": {
      "main": [
        [
          {
            "node": "generar json woocommerce",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generar json woocommerce": {
      "main": [
        [
          {
            "node": "crear orden",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execution Data": {
      "main": [
        [
          {
            "node": "pedido",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-20T21:50:31.967Z",
  "id": "qL4h7ObV8abgWp3l",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "Integraci√≥n woocommerce",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "68ce8261-443c-44c1-b8dd-d12bd30f6cf3",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -460,
        140
      ],
      "id": "b06a6cdd-c6d8-4c2b-b3cf-7b1076560f2b",
      "name": "Webhook",
      "webhookId": "68ce8261-443c-44c1-b8dd-d12bd30f6cf3"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://matemundo.com.ar/wp-json/wc/v3/orders",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "consumer_key",
              "value": "ck_2cd792733a169668b322011064ef7514abd2f7cc"
            },
            {
              "name": "consumer_secret",
              "value": "cs_8a6e815ffdc78babd23c461f3b9e0da3cc8f4002"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        420,
        140
      ],
      "id": "436310ab-b1ec-4d95-8373-9137a87d14c4",
      "name": "crear orden"
    },
    {
      "parameters": {
        "jsCode": "let jsonProducts = JSON.parse($('Webhook').first().json.body.customData.pedido ?? \"{}\");\n\nreturn jsonProducts;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -20,
        140
      ],
      "id": "ade79c80-ce4c-445e-873b-74736791963b",
      "name": "pedido",
      "executeOnce": true
    },
    {
      "parameters": {
        "jsCode": "// Obtenemos el JSON de entrada (tu pedido)\nconst data = items[0].json;\n\n// Creamos array de line_items a partir de cada producto\nconst line_items = data.pedido.map(p => {\n  if (p.type === \"variable\") {\n    // Producto variable -> se env√≠a con variation_id\n    return {\n      product_id: p.codigo_producto,\n      variation_id: p.id_variacion,\n      quantity: p.cantidad,\n      price: p.precio_unitario\n    };\n  } else {\n    // Producto simple -> NO se env√≠a variation_id\n    return {\n      product_id: p.codigo_producto,\n      quantity: p.cantidad,\n      price: p.precio_unitario\n    };\n  }\n});\n\n// Construimos la orden con datos quemados de billing/shipping\nconst order = {\n  payment_method: \"bacs\",\n  payment_method_title: \"Transferencia bancaria\",\n  customer_note: \"Pedido generado desde Ropofy\", // üëà nota fija\n  set_paid: false,\n  billing: {\n    first_name: $('Webhook').first().json.body.first_name,\n    last_name: \"\",\n    address_1: $('Webhook').first().json.body['Dirrecion cliente'],\n    city: $('Webhook').first().json.body.city,\n    country: \"AR\",\n    email: $('Webhook').first().json.body.email,\n    phone: $('Webhook').first().json.body.phone\n  },\n  shipping: {\n    first_name: $('Webhook').first().json.body.first_name,\n    last_name: \"\",\n    address_1: $('Webhook').first().json.body['Dirrecion cliente'],\n    city: $('Webhook').first().json.body.city,\n    country: \"AR\"\n  },\n  line_items\n};\n\n// Retornamos en el formato que n8n espera (un √∫nico item con el JSON)\nreturn [\n  {\n    json: order\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        200,
        140
      ],
      "id": "c487716a-b6f4-4c76-8776-9b44a10f8cf4",
      "name": "generar json woocommerce"
    },
    {
      "parameters": {
        "dataToSave": {
          "values": [
            {
              "key": "email",
              "value": "={{ $json.body.email }}"
            },
            {
              "key": "phone",
              "value": "={{ $json.body.phone }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executionData",
      "typeVersion": 1.1,
      "position": [
        -240,
        140
      ],
      "id": "32476497-e933-4d0c-8da4-6cd02ec40927",
      "name": "Execution Data"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://matemundo.com.ar/wp-json/wc/v3/orders/{{ $json.id }}/notes",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "consumer_key",
              "value": "ck_2cd792733a169668b322011064ef7514abd2f7cc"
            },
            {
              "name": "consumer_secret",
              "value": "cs_8a6e815ffdc78babd23c461f3b9e0da3cc8f4002"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "note",
              "value": "Generado desde ropofy"
            },
            {
              "name": "customer_note",
              "value": "false"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        640,
        140
      ],
      "id": "b99431c7-dbca-4aac-b0c2-a24e1b124a7e",
      "name": "Crear nota de creacion desde ropofy"
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "accept": "application/json, text/plain, */*",
            "host": "ropoflow-c4acfzgsbqa5bfad.canadacentral-01.azurewebsites.net",
            "user-agent": "axios/1.7.7",
            "accept-encoding": "gzip, compress, deflate, br",
            "max-forwards": "10",
            "x-arr-log-id": "c0517313-63cd-4480-87f2-16ee90405f32",
            "client-ip": "34.63.176.17:41142",
            "disguised-host": "ropoflow-c4acfzgsbqa5bfad.canadacentral-01.azurewebsites.net",
            "x-site-deployment-id": "ropoflow",
            "was-default-hostname": "ropoflow-c4acfzgsbqa5bfad.canadacentral-01.azurewebsites.net",
            "x-forwarded-proto": "https",
            "x-appservice-proto": "https",
            "x-arr-ssl": "2048|256|CN=Microsoft Azure RSA TLS Issuing CA 04, O=Microsoft Corporation, C=US|CN=*.azurewebsites.net, O=Microsoft Corporation, L=Redmond, S=WA, C=US",
            "x-forwarded-tlsversion": "1.3",
            "x-forwarded-for": "34.63.176.17:41142",
            "x-original-url": "/webhook/68ce8261-443c-44c1-b8dd-d12bd30f6cf3",
            "x-waws-unencoded-url": "/webhook/68ce8261-443c-44c1-b8dd-d12bd30f6cf3",
            "x-client-ip": "34.63.176.17",
            "x-client-port": "41142",
            "content-type": "application/json",
            "content-length": "2265"
          },
          "params": {},
          "query": {},
          "body": {
            "CUIT o DNI": "",
            "Transporte": "",
            "N¬∞ Cliente ENEXPRO": "",
            "Link al pedido": "",
            "Tipo de cliente": "Cliente Mayorista",
            "Tipo de Solicitud": "Hacer un pedido",
            "Tipo de env√≠o": "Envi√≥ a domicilio",
            "Resumen pedido": "üõçÔ∏è Productos seleccionados:\n50 √ó Mate Algarrobo Juje√±o Acero (Liso) ‚Üí $6.350 c/u\n50 √ó Bombilla Acero Inox. Virola Bronce - Plana Perita ‚Üí $1.500 c/u\nValor total = $317.500 + $75.000 = $392.500 + IVA\n¬øAcept√°s esta orden de compra?",
            "Sys single line": "",
            "Final pedido": "",
            "Direcci√≥n cliente": "Pasteur 132, mar del plata",
            "Ciudad Domilicio": "Mar del Plata",
            "Correo - BOT": "",
            "Telefono - BOT": "",
            "Tipo de reclamo": "",
            "Nombre - BOT": "Federico",
            "contact_id": "Doq9immwRvZzioMbCJUo",
            "first_name": "Federico",
            "last_name": "Aguirre Torrente",
            "full_name": "Federico Aguirre Torrente",
            "phone": "+5492233423232",
            "tags": "atendido por bot ai",
            "country": "AR",
            "date_created": "2025-06-15T03:23:25.899Z",
            "full_address": "",
            "contact_type": "lead",
            "location": {
              "name": "Mate mundo",
              "address": "Junin 449 ",
              "city": "CABA",
              "state": "Buenos Aires",
              "country": "AR",
              "postalCode": "1026",
              "fullAddress": "Junin 449 , CABA Buenos Aires 1026",
              "id": "ERJBpPNxe4pOmp7CkwAv"
            },
            "user": {
              "firstName": "Natalia",
              "lastName": "Castelli",
              "email": "natalia.castelli.1987@gmail.com",
              "phone": "+541140685713"
            },
            "workflow": {
              "id": "6ab19998-43c6-4042-8ae2-a0c5f7d6699d",
              "name": "Integraci√≥n woocomerce"
            },
            "triggerData": {},
            "contact": {
              "attributionSource": {
                "sessionSource": "Social media",
                "url": null,
                "medium": "whatsapp",
                "ctwa_clid": null,
                "adName": null,
                "adId": null
              },
              "lastAttributionSource": {
                "sessionSource": "Social media",
                "url": null,
                "medium": "whatsapp",
                "ctwa_clid": null,
                "adName": null,
                "adId": null
              }
            },
            "attributionSource": {},
            "customData": {
              "pedido": "{\n  \"pedido\": [\n    {\n      \"producto\": \"Mate Algarrobo Juje√±o Acero (Liso)\",\n      \"codigo_producto\": 15604,\n      \"variacion\": \"Liso\",\n      \"id_variacion\": 24240,\n      \"cantidad\": 50,\n      \"precio_unitario\": 6350,\n      \"type\": \"variable\"\n    },\n    {\n      \"producto\": \"Bombilla Acero Inox. Virola Bronce - Plana Perita\",\n      \"codigo_producto\": 19716,\n      \"variacion\": null,\n      \"id_variacion\": null,\n      \"cantidad\": 50,\n      \"precio_unitario\": 1500,\n      \"type\": \"simple\"\n    }\n  ]\n}"
            }
          },
          "webhookUrl": "https://ropoflow-c4acfzgsbqa5bfad.canadacentral-01.azurewebsites.net/webhook/68ce8261-443c-44c1-b8dd-d12bd30f6cf3",
          "executionMode": "production"
        }
      }
    ]
  },
  "repo_name": "ropoflow_workflows_backup",
  "repo_owner": "sebastianOrtizRopofy",
  "repo_path": "ropoflow_workflows_backup",
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-09-10T22:07:28.717Z",
  "versionId": "1bf6977c-1bd3-43ec-bd77-e9ca5eacf97c"
}